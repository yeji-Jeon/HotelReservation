(function(a){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./grid.common"],a):"object"===typeof module&&module.exports?module.exports=function(l,g){l||(l=window);void 0===g&&(g="undefined"!==typeof window?require("jquery"):require("jquery")(l));require("./grid.base");require("./grid.common");a(g);return g}:a(jQuery)})(function(a){var l=a.jgrid;a.fn.jqFilter=function(g){if("string"===typeof g){var r=a.fn.jqFilter[g];if(!r)throw"jqFilter - No such method: "+g;var D=a.makeArray(arguments).slice(1);
return r.apply(this,D)}var c=a.extend(!0,{filter:null,columns:[],onChange:null,afterRedraw:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,sopt:null,ops:[],operands:null,numopts:"eq ne lt le gt ge nu nn in ni".split(" "),stropts:"eq ne bw bn ew en cn nc nu nn in ni".split(" "),strarr:["text","string","blob"],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,direction:"ltr"},l.filter,g||{});return this.each(function(){if(!this.filter){this.p=c;if(null===c.filter||
void 0===c.filter)c.filter={groupOp:c.groupOps[0].op,rules:[],groups:[]};var g,r=c.columns.length,e,G=/msie/i.test(navigator.userAgent)&&!window.opera,w=a.isFunction,H=null!=l.defaults&&w(l.defaults.fatalError)?l.defaults.fatalError:alert,t=function(){return a("#"+l.jqID(c.id))[0]||null},q=function(d,c){return a(t()).jqGrid("getGuiStyles",d,c||"")},B=function(d){return a(t()).jqGrid("getGridRes","search."+d)},I=function(a){var d=t(),b=d.p.iColByName[a];if(void 0!==b)return{cm:d.p.colModel[b],iCol:b};
b=d.p.iPropByName[a];return void 0!==b?{cm:d.p.colModel[b],iCol:b,isAddProp:!0}:{cm:null,iCol:-1}},E=q("states.error"),D=q("dialog.content");c.initFilter=a.extend(!0,{},c.filter);if(r){for(g=0;g<r;g++)e=c.columns[g],e.stype?e.inputtype=e.stype:e.inputtype||(e.inputtype="text"),e.sorttype?e.searchtype=e.sorttype:e.searchtype||(e.searchtype="string"),void 0===e.hidden&&(e.hidden=!1),e.label||(e.label=e.name),e.cmName=e.name,e.index&&(e.name=e.index),e.hasOwnProperty("searchoptions")||(e.searchoptions=
{}),e.hasOwnProperty("searchrules")||(e.searchrules={});c.showQuery&&a(this).append("<table class='queryresult "+D+"' style='display:block;max-width:440px;border:0px none;' dir='"+c.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>");var J=function(a,n){var b=[!0,""],d=t();if(w(n.searchrules))b=n.searchrules.call(d,a,n);else if(l&&l.checkValues)try{b=l.checkValues.call(d,a,-1,n.searchrules,n.label)}catch(x){}b&&b.length&&!1===b[0]&&(c.error=!b[0],c.errmsg=b[1])};this.onchange=function(){c.error=
!1;c.errmsg="";return w(c.onChange)?c.onChange.call(t(),c,this):!1};this.reDraw=function(){a("table.group:first",this).remove();var d=this.createTableForGroup(c.filter,null);a(this).append(d);w(c.afterRedraw)&&c.afterRedraw.call(t(),c,this)};this.createTableForGroup=function(d,n){var b=this,h,g=a("<table class='"+q("searchDialog.operationGroup","group")+"' style='border:0px none;'><tbody></tbody></table>"),f="left";"rtl"===c.direction&&(f="right",g.attr("dir","rtl"));null===n&&g.append("<tr class='error' style='display:none;'><th colspan='5' class='"+
E+"' align='"+f+"'></th></tr>");var k=a("<tr></tr>");g.append(k);f=a("<th colspan='5' align='"+f+"'></th>");k.append(f);if(!0===c.ruleButtons){var F=a("<select class='"+q("searchDialog.operationSelect","opsel")+"'></select>");f.append(F);var k="",e;for(h=0;h<c.groupOps.length;h++)e=d.groupOp===b.p.groupOps[h].op?" selected='selected'":"",k+="<option value='"+b.p.groupOps[h].op+"'"+e+">"+b.p.groupOps[h].text+"</option>";F.append(k).on("change",function(){d.groupOp=a(F).val();b.onchange()})}k="<span></span>";
c.groupButton&&(k=a("<input type='button' value='+ {}' title='"+B("addGroupTitle")+"' class='"+q("searchDialog.addGroupButton","add-group")+"'/>"),k.on("click",function(){void 0===d.groups&&(d.groups=[]);d.groups.push({groupOp:c.groupOps[0].op,rules:[],groups:[]});b.reDraw();b.onchange();return!1}));f.append(k);if(!0===c.ruleButtons){var k=a("<input type='button' value='+' title='"+B("addRuleTitle")+"' class='"+q("searchDialog.addRuleButton","add-rule ui-add")+"'/>"),l;k.on("click",function(){var c,
f,k;void 0===d.rules&&(d.rules=[]);for(h=0;h<b.p.columns.length;h++)if(c=void 0===b.p.columns[h].search?!0:b.p.columns[h].search,f=!0===b.p.columns[h].hidden,(k=!0===b.p.columns[h].searchoptions.searchhidden)&&c||c&&!f){l=b.p.columns[h];break}c=l.searchoptions.sopt?l.searchoptions.sopt:b.p.sopt?b.p.sopt:-1!==a.inArray(l.searchtype,b.p.strarr)?b.p.stropts:b.p.numopts;d.rules.push({field:l.name,op:c[0],data:""});b.reDraw();return!1});f.append(k)}null!==n&&(k=a("<input type='button' value='-' title='"+
B("deleteGroupTitle")+"' class='"+q("searchDialog.deleteGroupButton","delete-group")+"'/>"),f.append(k),k.on("click",function(){for(h=0;h<n.groups.length;h++)if(n.groups[h]===d){n.groups.splice(h,1);break}b.reDraw();b.onchange();return!1}));if(void 0!==d.groups)for(h=0;h<d.groups.length;h++)f=a("<tr></tr>"),g.append(f),k=a("<td class='first'></td>"),f.append(k),k=a("<td colspan='4'></td>"),k.append(this.createTableForGroup(d.groups[h],d)),f.append(k);void 0===d.groupOp&&(d.groupOp=b.p.groupOps[0].op);
if(void 0!==d.rules)for(h=0;h<d.rules.length;h++)g.append(this.createTableRowForRule(d.rules[h],d));return g};this.createTableRowForRule=function(d,g){var b=this,h=t(),n=a("<tr></tr>"),f,k,e,p="",u;n.append("<td class='first'></td>");var m=a("<td class='columns'></td>");n.append(m);var r=a("<select class='"+q("searchDialog.label","selectLabel")+"'></select>"),y,v=[];m.append(r);r.on("change",function(){d.field=a(r).val();var c=a(this).parents("tr:first"),f,e;for(e=0;e<b.p.columns.length;e++)if(b.p.columns[e].name===
d.field){f=b.p.columns[e];break}if(f){e=a.extend({},f.editoptions||{});delete e.readonly;delete e.disabled;var g=a.extend({},e||{},f.searchoptions||{},I(f.cmName),{id:l.randId(),name:f.name,mode:"search"});g.column=f;G&&"text"===f.inputtype&&!g.size&&(g.size=10);var n=l.createEl.call(h,f.inputtype,g,"",!0,b.p.ajaxSelectOptions||{},!0);a(n).addClass(q("searchDialog.elem","input-elm"));k=g.sopt?g.sopt:b.p.sopt?b.p.sopt:-1!==a.inArray(f.searchtype,b.p.strarr)?b.p.stropts:b.p.numopts;f="";var m=0,x,p;
v=[];a.each(b.p.ops,function(){v.push(this.oper)});b.p.cops&&a.each(b.p.cops,function(b){v.push(b)});for(e=0;e<k.length;e++)p=k[e],y=a.inArray(k[e],v),-1!==y&&(x=b.p.ops[y],x=void 0!==x?x.text:b.p.cops[p].text,0===m&&(d.op=p),f+="<option value='"+p+"'>"+x+"</option>",m++);a(".selectopts",c).empty().append(f);a(".selectopts",c)[0].selectedIndex=0;l.msie&&9>l.msiever()&&(e=parseInt(a("select.selectopts",c)[0].offsetWidth,10)+1,a(".selectopts",c).width(e),a(".selectopts",c).css("width","auto"));a(".data",
c).empty().append(n);l.bindEv.call(h,n,g);a(".input-elm",c).on("change",function(c){c=c.target;d.data="SPAN"===c.nodeName.toUpperCase()&&g&&w(g.custom_value)?g.custom_value.call(h,a(c).children(".customelement:first"),"get"):c.value;a(c).is("input[type=checkbox]")&&!a(c).is(":checked")&&(d.data=a(c).data("offval"));b.onchange()});setTimeout(function(){d.data=a(n).val();b.onchange()},0)}});var m=0,z,A;for(f=0;f<b.p.columns.length;f++)if(u=void 0===b.p.columns[f].search?!0:b.p.columns[f].search,z=!0===
b.p.columns[f].hidden,(A=!0===b.p.columns[f].searchoptions.searchhidden)&&u||u&&!z)u="",d.field===b.p.columns[f].name&&(u=" selected='selected'",m=f),p+="<option value='"+b.p.columns[f].name+"'"+u+">"+b.p.columns[f].label+"</option>";r.append(p);p=a("<td class='operators'></td>");n.append(p);e=c.columns[m];G&&"text"===e.inputtype&&!e.searchoptions.size&&(e.searchoptions.size=10);m=a.extend({},e.editoptions||{});delete m.readonly;delete m.disabled;m=a.extend({},m,e.searchoptions||{},I(e.cmName),{id:l.randId(),
name:e.name});m.column=e;m=l.createEl.call(h,e.inputtype,m,d.data,!0,b.p.ajaxSelectOptions||{},!0);if("nu"===d.op||"nn"===d.op||0<=a.inArray(d.op,h.p.customUnaryOperations))a(m).attr("readonly","true"),a(m).attr("disabled","true");var C=a("<select class='"+q("searchDialog.operator","selectopts")+"'></select>");p.append(C);C.on("change",function(){d.op=a(C).val();var c=a(this).parents("tr:first"),c=a(".input-elm",c)[0];"nu"===d.op||"nn"===d.op||0<=a.inArray(d.op,h.p.customUnaryOperations)?(d.data=
"","SELECT"!==c.tagName.toUpperCase()&&(c.value=""),c.setAttribute("readonly","true"),c.setAttribute("disabled","true")):("SELECT"===c.tagName.toUpperCase()&&(d.data=c.value),c.removeAttribute("readonly"),c.removeAttribute("disabled"));b.onchange()});k=e.searchoptions.sopt?e.searchoptions.sopt:b.p.sopt?b.p.sopt:-1!==a.inArray(e.searchtype,b.p.strarr)?b.p.stropts:b.p.numopts;p="";a.each(b.p.ops,function(){v.push(this.oper)});b.p.cops&&a.each(b.p.cops,function(b){v.push(b)});for(f=0;f<k.length;f++)A=
k[f],y=a.inArray(k[f],v),-1!==y&&(z=b.p.ops[y],u=d.op===A?" selected='selected'":"",p+="<option value='"+A+"'"+u+">"+(void 0!==z?z.text:b.p.cops[A].text)+"</option>");C.append(p);p=a("<td class='data'></td>");n.append(p);p.append(m);l.bindEv.call(h,m,e.searchoptions);a(m).addClass(q("searchDialog.elem","input-elm")).on("change",function(){d.data="custom"===e.inputtype?e.searchoptions.custom_value.call(h,a(this).children(".customelement:first"),"get"):a(this).val();a(this).is("input[type=checkbox]")&&
!a(this).is(":checked")&&(d.data=a(this).data("offval"));b.onchange()});p=a("<td></td>");n.append(p);!0===c.ruleButtons&&(m=a("<input type='button' value='-' title='"+B("deleteRuleTitle")+"' class='"+q("searchDialog.deleteRuleButton","delete-rule ui-del")+"'/>"),p.append(m),m.on("click",function(){for(f=0;f<g.rules.length;f++)if(g.rules[f]===d){g.rules.splice(f,1);break}b.reDraw();b.onchange();return!1}));return n};this.getStringForGroup=function(a){var c="(",b;if(void 0!==a.groups)for(b=0;b<a.groups.length;b++){1<
c.length&&(c+=" "+a.groupOp+" ");try{c+=this.getStringForGroup(a.groups[b])}catch(h){H(h)}}if(void 0!==a.rules)try{for(b=0;b<a.rules.length;b++)1<c.length&&(c+=" "+a.groupOp+" "),c+=this.getStringForRule(a.rules[b])}catch(h){H(h)}c+=")";return"()"===c?"":c};this.getStringForRule=function(d){var e="",b="",h,g,f=d.data,k;for(h=0;h<c.ops.length;h++)if(c.ops[h].oper===d.op){e=c.operands.hasOwnProperty(d.op)?c.operands[d.op]:"";b=c.ops[h].oper;break}if(""===b&&null!=c.cops)for(k in c.cops)if(c.cops.hasOwnProperty(k)&&
(b=k,e=c.cops[k].operand,w(c.cops[k].buildQueryValue)))return c.cops[k].buildQueryValue.call(c,{cmName:d.field,searchValue:f,operand:e});for(h=0;h<c.columns.length;h++)if(c.columns[h].name===d.field){g=c.columns[h];break}if(null==g)return"";if("bw"===b||"bn"===b)f+="%";if("ew"===b||"en"===b)f="%"+f;if("cn"===b||"nc"===b)f="%"+f+"%";if("in"===b||"ni"===b)f=" ("+f+")";c.errorcheck&&J(d.data,g);return-1!==a.inArray(g.searchtype,["int","integer","float","number","currency"])||"nn"===b||"nu"===b||0<=a.inArray(b,
t().p.customUnaryOperations)?d.field+" "+e+" "+f:d.field+" "+e+' "'+f+'"'};this.resetFilter=function(){c.filter=a.extend(!0,{},c.initFilter);this.reDraw();this.onchange()};this.hideError=function(){a("th."+E,this).html("");a("tr.error",this).hide()};this.showError=function(){a("th."+E,this).html(c.errmsg);a("tr.error",this).show()};this.toUserFriendlyString=function(){return this.getStringForGroup(c.filter)};this.toString=function(){function a(b){var c="(",d;if(void 0!==b.groups)for(d=0;d<b.groups.length;d++)1<
c.length&&(c="OR"===b.groupOp?c+" || ":c+" && "),c+=a(b.groups[d]);if(void 0!==b.rules)for(d=0;d<b.rules.length;d++){1<c.length&&(c="OR"===b.groupOp?c+" || ":c+" && ");var f=void 0,g,l=b.rules[d];if(e.p.errorcheck){for(g=0;g<e.p.columns.length;g++)if(e.p.columns[g].name===l.field){f=e.p.columns[g];break}f&&J(l.data,f)}c+=l.op+"(item."+l.field+",'"+l.data+"')"}c+=")";return"()"===c?"":c}var e=this;return a(c.filter)};this.reDraw();if(c.showQuery)this.onchange();this.filter=!0}}})};a.extend(a.fn.jqFilter,
{toSQLString:function(){var a="";this.each(function(){a=this.toUserFriendlyString()});return a},filterData:function(){var a;this.each(function(){a=this.p.filter});return a},getParameter:function(a){return void 0!==a&&this.p.hasOwnProperty(a)?this.p[a]:this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(g){"string"===typeof g&&(g=a.parseJSON(g));this.each(function(){this.p.filter=g;this.reDraw();this.onchange()})}})});
//# sourceMappingURL=grid.filter.map
